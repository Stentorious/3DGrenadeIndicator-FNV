<_screen_width> <copy src="screen()" trait="width" /> </_screen_width>
<_screen_height> <copy src="screen()" trait="height" /> </_screen_height>

<rect name="3DGrenade">

	<!-- ### Configuration Traits ### -->
	<_IconScale> 1 </_IconScale>	<!-- Icon scale -->
	<_Timer> 0 </_Timer>			<!-- Fuse timer style -->

	<!-- Icon type -->
	<_Icon> 0 </_Icon>
	<_filename_0> Interface\Icons\typeicons\hot_keys_icon_throwweapons.dds </_filename_0>
	<_filename_1> Interface\Stentorious\3DGrenade\ySI.dds </_filename_1>
	<_filename>
		<copy src="me()" trait="_Icon"/>
		<copy src="me()" trait="_filename_"/>
	</_filename>

	<!-- Icon alpha pulse -->
	<_AlphaPulseToggle> 0 </_AlphaPulseToggle>
	<_AlphaPulse> 0 </_AlphaPulse>

	<!-- Visibility distance -->
	<_DistMode> 0 </_DistMode>
	<_DistMax> 0 </_DistMax>
	<_DistMaxUnit>
		<copy src="me()" trait="_DistMax"/>
		<mul> 69.99104 </mul>
	</_DistMaxUnit>
	<_Dist>
		<copy> 0 </copy>
		<add src="me()" trait="_DistMaxUnit" />
		<onlyifnot src="me()" trait="_DistMode" />
		<add>
			<copy src="me()" trait="_DistMaxUnit" />
			<div> 1680 </div>
			<mul>
				<log src="me()" trait="_PlrAV6" />
				<div> <log> 4 </log> </div>
				<mul> 1000 </mul>
				<add> 1100 </add>
				<div> 1.65 </div>
			</mul>
			<onlyif src="me()" trait="_DistMode" />
		</add>
	</_Dist>

	<!-- ### Script Traits ### -->
	<_visible> 1 </_visible>		<!-- General visibility flag -->
	<_visible_pa> 1 </_visible_pa>	<!-- Power armor visibility flag -->
	<_PlrAV6> 0 </_PlrAV6>			<!-- Player perception -->

	<visible>
		<copy src="ReticleCenter" trait="visible" />
		<or src="AmmoTypeLabel" trait="visible" />
		<or src="ActionPoints" trait="visible" />
		<or src="HitPoints" trait="visible" />
		<and src="me()" trait="_visible" />
		<and src="me()" trait="_visible_pa" />
	</visible>

	<_Width>
		<copy> 32 </copy>
		<mul>
			<copy src="io()" trait="_duiscale_65" />
			<onlyif src="io()" trait="_DUIF3" />
			<add>
				<copy> 1 </copy>
				<onlyifnot src="io()" trait="_DUIF3" />
			</add>
		</mul>
		<mul src="me()" trait="_IconScale" />
	</_Width>
	<_Font>
		<copy> 3 </copy>
		<add>
			<copy> 1 </copy>
			<onlyif src="io()" trait="_DUIF3" />
		</add>
	</_Font>
	<_FontY>
		<copy> 0 </copy>
		<add> 7.6 </add>
		<onlyifnot src="io()" trait="_DUIF3" />
		<mul src="me()" trait="_IconScale" />
	</_FontY>
	<_xMax>
		<copy src="me()" trait="_Width" />
		<div> 2 </div>
		<add> 5 </add>
	</_xMax>
	<_xMin>
		<copy src="io()" trait="_screen_width" />
		<sub src="me()" trait="_xMax" />
	</_xMin>
	<_yMax>
		<copy> 5 </copy>
		<add src="child(DummyText)" trait="height" />
		<add src="me()" trait="_Width" />
	</_yMax>
	<_yMin>
		<copy src="io()" trait="_screen_height" />
		<sub> 5 </sub>
	</_yMin>

	<text name="DummyText">
		<visible> 0 </visible>
		<alpha> 0 </alpha>
		<zoom>
			<copy> 80 </copy>
			<mul src="parent()" trait="_IconScale" />
		</zoom>
		<font> <copy src="parent()" trait="_Font" /> </font>
		<justify> &center; </justify>
		<string> 9.9 </string>
	</text>

</rect>

<template name="3DGrenade_Rect_Template">
	<rect name="3DGrenade_Rect_Template"></rect>
</template>

<template name="3DGrenade_Icon_Template">
	<rect name="3DGrenade_Icon_Template">

		<visible>
			<copy src="me()" trait="_Dist" />
			<lte src="grandparent()" trait="_Dist" />
		</visible>
		<locus> &true; </locus>
		<x>
			<copy src="me()" trait="_x" />
			<mul src="io()" trait="_screen_width" />
			<max src="grandparent()" trait="_xMax" />
			<min src="grandparent()" trait="_xMin" />
		</x>
		<y>
			<copy src="me()" trait="_y" />
			<mul src="io()" trait="_screen_height" />
			<max src="grandparent()" trait="_yMax" />
			<min src="grandparent()" trait="_yMin" />
		</y>

		<!-- ### Script Traits ### -->
		<_x> -1 </_x>							<!-- W2S X position -->
		<_y> -1 </_y>							<!-- W2S Y position -->
		<_Dist> 0 </_Dist>						<!-- Distance from player -->
		<_DistDMG> 0 </_DistDMG>				<!-- Explosion damage radius -->
		<_IconColor> 1 </_IconColor>			<!-- Icon systemcolor -->
		<_TimerNum> 1 </_TimerNum>				<!-- Remaining detonation timer -->
		<_TimerMax> 1 </_TimerMax>				<!-- Total detonation timer -->

		<!-- Calculate icon alpha -->
		<_alpha>
			<copy> 255 </copy>
			<sub>
				<copy src="me()" trait="_Dist" />
				<pow> 4 </pow>
				<div>
					<copy src="grandparent()" trait="_Dist"/>
					<pow> 4 </pow>
				</div>
				<mul> 255 </mul>
			</sub>
			<max> 0 </max>
			<min> 255 </min>
		</_alpha>

		<rect name="IconClip">
			<clipwindow> 1 </clipwindow>
			<depth> 0 </depth>
			<width> <copy src="3DGrenade" trait="_Width" /> </width>
			<height> <copy src="me()" trait="width" /> </height>
			<x>
				<copy src="me()" trait="width" />
				<div> -2 </div>
			</x>
			<y>
				<copy src="me()" trait="height" />
				<div> -1 </div>
				<add>
					<copy src="me()" trait="width" />
					<mul>
						<copy> 1 </copy>
						<sub>
							<copy src="parent()" trait="_TimerNum" />
							<div src="parent()" trait="_TimerMax" />
						</sub>
					</mul>
					<onlyif>
						<copy src="3DGrenade" trait="_Timer" />
						<gt> 1 </gt>
					</onlyif>
				</add>
			</y>
			<image name="Icon">
				<clips> 1 </clips>
				<alpha> <copy src="grandparent()" trait="_alpha" /> </alpha>
				<locus> &true; </locus>
				<depth> -11 </depth>
				<x>
					<copy src="me()" trait="width" />
					<div> -2 </div>
				</x>
				<y>
					<copy src="me()" trait="height" />
					<div> -1 </div>
				</y>
				<width> <copy src="parent" trait="width" /> </width>
				<height> <copy src="me()" trait="width" /> </height>
				<zoom> &scale; </zoom>
				<systemcolor>
					<copy> 0 </copy>
					<add>
						<copy src="grandparent()" trait="_IconColor" />
						<onlyifnot>
							<copy src="grandparent()" trait="_Dist" />
							<lte src="grandparent()" trait="_DistDMG" />
						</onlyifnot>
					</add>
					<add>
						<copy> 2 </copy>
						<onlyif>
							<copy src="grandparent()" trait="_Dist" />
							<lte src="grandparent()" trait="_DistDMG" />
						</onlyif>
					</add>
				</systemcolor>
				<brightness>
					<copy> 255 </copy>
					<mul>
						<copy> 1 </copy>
						<sub>
							<copy src="3DGrenade" trait="_AlphaPulse" />
							<onlyif>
								<copy src="me()" trait="systemcolor" />
								<eq> 2 </eq>
								<and src="3DGrenade" trait="_AlphaPulseToggle" />
							</onlyif>
						</sub>
					</mul>
				</brightness>
				<filename> <copy src="3DGrenade" trait="_filename" /> </filename>
			</image>
			<image name="IconBackground">
				<visible>
					<copy src="3DGrenade" trait="_Timer" />
					<gt> 1 </gt>
				</visible>
				<alpha> <copy src="sibling(Icon)" trait="alpha" /> </alpha>
				<locus> 1 </locus>
				<depth> -12 </depth>
				<x> <copy src="sibling(Icon)" trait="x" /> </x>
				<y> <copy src="sibling(Icon)" trait="y" /> </y>
				<height> <copy src="sibling(Icon)" trait="height" /> </height>
				<width> <copy src="sibling(Icon)" trait="width" /> </width>
				<zoom> &scale; </zoom>
				<systemcolor> <copy src="sibling(Icon)" trait="systemcolor" /> </systemcolor>
				<red> 76.5 </red>
				<green> 76.5 </green>
				<blue> 76.5 </blue>
				<brightness> 76.5 </brightness>
				<filename> <copy src="sibling(Icon)" trait="filename" /> </filename>
			</image>
			<image name="DropShadow">
				<visible> 1 </visible>
				<alpha>
					<copy src="sibling(Icon)" trait="alpha" />
					<div> 2 </div>
				</alpha>
				<depth> -13 </depth>
				<x>
					<copy src="sibling(Icon)" trait="x" />
					<add src="3DGrenade" trait="_IconScale" />
				</x>
				<y>
					<copy src="sibling(Icon)" trait="y" />
					<add src="3DGrenade" trait="_IconScale" />
				</y>
				<height> <copy src="sibling(Icon)" trait="height" /> </height>
				<width> <copy src="sibling(Icon)" trait="width" /> </width>
				<zoom> &scale; </zoom>
				<systemcolor> 0 </systemcolor>
				<red> 0 </red>
				<green> 0 </green>
				<blue> 0 </blue>
				<brightness> 0 </brightness>
				<filename> <copy src="sibling(Icon)" trait="filename" /> </filename>
			</image>
		</rect>

		<text name="Timer">
			<visible>
				<copy src="3DGrenade" trait="_Timer" />
				<eq> 1 </eq>
				<or>
					<copy src="3DGrenade" trait="_Timer" />
					<eq> 3 </eq>
				</or>
			</visible>
			<alpha> <copy src="parent()" trait="_alpha" /> </alpha>
			<depth> -10 </depth>
			<x>
				<copy> 0 </copy>
				<add>
					<copy src="me()" trait="width" />
					<div> 2 </div>
					<sub src="parent()" trait="x" />
					<max> 0 </max>
				</add>
				<sub>
					<copy src="me()" trait="width" />
					<div> 2 </div>
					<sub src="io()" trait="_screen_width" />
					<add src="parent()" trait="x" />
					<max> 0 </max>
				</sub>
			</x>
			<y>
				<copy src="3DGrenade" trait="_FontY" />
				<sub src="me()" trait="height" />
				<sub src="sibling(IconClip)" trait="height" />
			</y>
			<zoom>
				<copy> 80 </copy>
				<mul src="3DGrenade" trait="_IconScale" />
			</zoom>
			<systemcolor>
				<copy> 1 </copy>
				<add>
					<copy> 1 </copy>
					<onlyif>
						<copy src="parent()" trait="_Dist" />
						<lte src="parent()" trait="_DistDMG" />
					</onlyif>
				</add>
			</systemcolor>
			<font> <copy src="3DGrenade" trait="_Font" /> </font>
			<justify> &center; </justify>
			<string> <copy src="parent()" trait="_Timer" /> </string>
		</text>

	</rect>
</template>